<!DOCTYPE html>
<html lang="en">
<head>
		<title>Maps & Apps &mdash; Articles tagged ggplot2</title>
		<meta charset="utf-8" />
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="stylesheet" type="text/css" href="/theme/css/style.css" />
		<link rel='stylesheet' id='oswald-css'  href='http://fonts.googleapis.com/css?family=Oswald&#038;ver=3.3.2' type='text/css' media='all' />
		<style type="text/css">
			body.custom-background { background-color: #f5f5f5; }
		</style>
		<link rel="alternate" type="application/atom+xml"
			title="Maps & Apps â€” Flux Atom"
			href="/" /> 
		<!--[if lte IE 8]><script src="/theme/js/html5shiv.js"></script><![endif]-->
</head>

<body class="home blog custom-background " >
	<div id="container">
		<div id="header">
				<h1 id="site-title"><a href="">Maps & Apps</a></h1>
		</div><!-- /#banner -->
		
		<div id="menu">
			<div class="menu-navigation-container">
				<ul id="menu-navigation" class="menu">
						<li class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/category/.html"></a></li>
						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/category/latex.html">LaTeX</a></li>
						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/category/leaflet.html">Leaflet</a></li>
						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/category/python.html">Python</a></li>
						<li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/category/r.html">R</a></li>
						<li  class="active" class="menu-item menu-item-type-post_type menu-item-object-page"><a href="http://mollietaylor.com/">About Mollie Link Will Go Here</a></li>

				</ul>
			</div> <!--/#menu-navigation-container-->
		</div><!-- /#menu -->
		
		<div class="page-title">
<div class="page-title">
	<h2>Tagged with <span>ggplot2</span> &hellip;</h2>
</div>
		</div>
	
		<div id="contents">
<div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/014/02/ggplot-fit-line-and-lattice-fit-line-in.html">Thu 13 February 2014</a></div>
		<span class="byline">By <a href="/author/mollie-taylor.html">Mollie Taylor</a></span>
			<span class="cat-links"><a href="/category/r.html" title="View all posts in R" rel="category tag">R</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/014/02/ggplot-fit-line-and-lattice-fit-line-in.html" title="Permalink to ggplot Fit Line and Lattice Fit Line in R" rel="bookmark">ggplot Fit Line and Lattice Fit Line in R</a>
		</h2>
		<div class="entry-content">
			<p>Let's add a fit line to a scatterplot!</p>
<h2>Fit Line in Base Graphics</h2>
<p>Here's how to do it in <strong>base</strong> graphics:</p>
<div class="highlight"><pre>ols <span class="o">&lt;-</span> lm<span class="p">(</span>Temp <span class="o">~</span> Solar.R<span class="p">,</span>
    data <span class="o">=</span> airquality<span class="p">)</span>

<span class="kp">summary</span><span class="p">(</span>ols<span class="p">)</span>

plot<span class="p">(</span>Temp <span class="o">~</span> Solar.R<span class="p">,</span>
    data <span class="o">=</span> airquality<span class="p">)</span>
abline<span class="p">(</span>ols
</pre></div>


<p><img alt="Fit line in base graphics in R" src="/images/ggplot-fit-line-base.png" /></p>
<h2>Fit Line in ggplot</h2>
<p>And here's how to do it in <strong>ggplot</strong>:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
ggplot<span class="p">(</span>data <span class="o">=</span> airquality<span class="p">,</span>
        aes<span class="p">(</span>Solar.R<span class="p">,</span> Temp<span class="p">))</span> <span class="o">+</span> 
    geom_point<span class="p">(</span>pch <span class="o">=</span> <span class="m">19</span><span class="p">)</span> <span class="o">+</span> 
    geom_abline<span class="p">(</span>intercept <span class="o">=</span> ols<span class="o">$</span>coefficients<span class="p">[</span><span class="m">1</span><span class="p">],</span>
        slope <span class="o">=</span> ols<span class="o">$</span>coefficients<span class="p">[</span><span class="m">2</span><span class="p">])</span>
</pre></div>


<p>You can access the info from your regression results through <code>ols$coefficients</code>.</p>
<p>Edit: Thanks to an anonymous commenter, I have learned that you can simplify this by using <code>geom_smooth</code>.  This way you don't have to specify the intercept and slope of the fit line.</p>
<div class="highlight"><pre>ggplot<span class="p">(</span>data <span class="o">=</span> airquality<span class="p">,</span>
        aes<span class="p">(</span>Solar.R<span class="p">,</span> Temp<span class="p">))</span> <span class="o">+</span> 
    geom_point<span class="p">(</span>pch <span class="o">=</span> <span class="m">19</span><span class="p">)</span> <span class="o">+</span> 
    geom_smooth<span class="p">(</span>method <span class="o">=</span> lm<span class="p">,</span>
        se <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</pre></div>


<p><img alt="Fit line in ggplot in R" src="/images/ggplot-fit-line-ggplot.png" /></p>
<h2>Fit Line in Lattice</h2>
<p>In <strong>lattice</strong>, it's even easier. You don't even need to run a regression; you can just add to the <code>type</code> option.</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>lattice<span class="p">)</span>

xyplot<span class="p">(</span>Temp <span class="o">~</span> Solar.R<span class="p">,</span>
    data <span class="o">=</span> airquality<span class="p">,</span>
    type <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">))</span>
</pre></div>


<p><img alt="Fit Line in Lattice in R" src="/images/ggplot-fit-line-lattice.png" /></p>
<p>The code is available in <a href="https://gist.github.com/mollietaylor/8203926">a gist</a>.</p>
<h2>References</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/12972039/plotting-xyplot-with-regression-line-on-lattice-graphics">http://stackoverflow.com/questions/12972039/plotting-xyplot-with-regression-line-on-lattice-graphics</a></li>
</ul>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/geom_abline.html" rel="tag">geom_abline</a>,  <a href="/tag/geom_smooth.html" rel="tag">geom_smooth</a>,  <a href="/tag/ggplot2.html" rel="tag">ggplot2</a>,  <a href="/tag/lattice.html" rel="tag">lattice</a>,  <a href="/tag/lm.html" rel="tag">lm</a>,  <a href="/tag/r.html" rel="tag">R</a>,  <a href="/tag/type.html" rel="tag">type</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/2013/10/table-as-image-in-r.html">Thu 24 October 2013</a></div>
		<span class="byline">By <a href="/author/mollie-taylor.html">Mollie Taylor</a></span>
			<span class="cat-links"><a href="/category/r.html" title="View all posts in R" rel="category tag">R</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/2013/10/table-as-image-in-r.html" title="Permalink to Table as an Image in R" rel="bookmark">Table as an Image in R</a>
		</h2>
		<div class="entry-content">
			<p>Usually, it's best to keep tables as text, but if you're making a lot of graphics, it can be helpful to be able to create images of tables.</p>
<p><img alt="PNG table" src="/images/r-table-image.png" /></p>
<h2>Creating the Table</h2>
<p>After loading the data, let's first use <a href="http://www.mollietaylor.com/2013/10/line-breaks-between-words-in-axis.html">this trick</a> to put line breaks between the levels of the effect variable. Depending on your data, you may or may not need or want to do this.</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>OIdata<span class="p">)</span>
data<span class="p">(</span>birds<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>gridExtra<span class="p">)</span>

<span class="c1"># line breaks between words for levels of birds$effect:</span>
<span class="kp">levels</span><span class="p">(</span>birds<span class="o">$</span>effect<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="kp">levels</span><span class="p">(</span>birds<span class="o">$</span>effect<span class="p">))</span>
</pre></div>


<p>Next let's make our table: </p>
<div class="highlight"><pre>xyTable <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>birds<span class="o">$</span>sky<span class="p">,</span> birds<span class="o">$</span>effect<span class="p">)</span>
</pre></div>


<p>Now we can create an empty plot, center our table in it, and use the <code>grid.table</code> function from the <strong>gridExtra</strong> package to display the table and choose a font size.</p>
<div class="highlight"><pre>plot.new<span class="p">()</span>
grid.table<span class="p">(</span>xyTable<span class="p">,</span>
    <span class="c1"># change font sizes:</span>
    gpar.coltext <span class="o">=</span> gpar<span class="p">(</span>cex <span class="o">=</span> <span class="m">1.2</span><span class="p">),</span>
    gpar.rowtext <span class="o">=</span> gpar<span class="p">(</span>cex <span class="o">=</span> <span class="m">1.2</span><span class="p">))</span>
</pre></div>


<p>Now you can view and save the image just like any other plot.</p>
<p><a href="https://gist.github.com/mollietaylor/6930567#file-tableasimage-simple-r">The code is available in a gist</a>.</p>
<h2>Citations and Further Reading</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/12318120/adding-table-within-the-plotting-region-of-a-ggplot-in-r">http://stackoverflow.com/questions/12318120/adding-table-within-the-plotting-region-of-a-ggplot-in-r</a></li>
<li><a href="http://stackoverflow.com/questions/12518387/can-i-create-an-empty-ggplot2-plot-in-r">http://stackoverflow.com/questions/12518387/can-i-create-an-empty-ggplot2-plot-in-r</a></li>
</ul>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/ggplot2.html" rel="tag">ggplot2</a>,  <a href="/tag/gridextra.html" rel="tag">gridExtra</a>,  <a href="/tag/qplot.html" rel="tag">qplot</a>,  <a href="/tag/r.html" rel="tag">R</a>,  <a href="/tag/table.html" rel="tag">table</a>,  <a href="/tag/tablegrob.html" rel="tag">tableGrob</a>,  <a href="/tag/visualization.html" rel="tag">visualization</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/2013/10/line-breaks-between-words-in-axis.html">Thu 17 October 2013</a></div>
		<span class="byline">By <a href="/author/mollie-taylor.html">Mollie Taylor</a></span>
			<span class="cat-links"><a href="/category/r.html" title="View all posts in R" rel="category tag">R</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/2013/10/line-breaks-between-words-in-axis.html" title="Permalink to Line Breaks Between Words in Axis Labels in ggplot in R" rel="bookmark">Line Breaks Between Words in Axis Labels in ggplot in R</a>
		</h2>
		<div class="entry-content">
			<p>Sometimes when plotting factor variables in R, the graphics can look pretty messy thanks to long factor levels. If the level attributes have multiple words, there is an easy fix to this that often makes the axis labels look much cleaner.</p>
<h2>Without Line Breaks</h2>
<p>Here's the messy looking example:</p>
<p><img alt="No line breaks in axis labels" src="/images/line-breaks-none.png" /></p>
<p>And here's the code for the messy looking example:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>OIdata<span class="p">)</span>
data<span class="p">(</span>birds<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>

ggplot<span class="p">(</span>birds<span class="p">,</span>
    aes<span class="p">(</span>x <span class="o">=</span> effect<span class="p">,</span>
        y <span class="o">=</span> speed<span class="p">))</span> <span class="o">+</span>
geom_boxplot<span class="p">()</span>
</pre></div>


<h2>With Line Breaks</h2>
<p>We can use <a href="http://regex.learncodethehardway.org/">regular expressions</a> to add line breaks to the factor levels by substituting any spaces with line breaks:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>OIdata<span class="p">)</span>
data<span class="p">(</span>birds<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>

<span class="kp">levels</span><span class="p">(</span>birds<span class="o">$</span>effect<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="kp">levels</span><span class="p">(</span>birds<span class="o">$</span>effect<span class="p">))</span>
ggplot<span class="p">(</span>birds<span class="p">,</span>
    aes<span class="p">(</span>x <span class="o">=</span> effect<span class="p">,</span>
        y <span class="o">=</span> speed<span class="p">))</span> <span class="o">+</span>
geom_boxplot<span class="p">()</span>
</pre></div>


<p><img alt="Line breaks in axis labels" src="/images/line-breaks.png" /></p>
<p>Just one line made the plot look much better, and it will carry over to other plots you make as well. For example, you could <a href="http://www.mollietaylor.com/2013/10/table-as-image-in-r.html">create a table with the same variable</a>.</p>
<h2>Horizontal Boxes</h2>
<p>Here we can see the difference in a box plot with horizontal boxes. It's up to you to decide which style looks better:</p>
<p><img alt="No line breaks in axis labels" src="/images/line-breaks-flip-none.png" /></p>
<p><img alt="Line breaks in axis labels" src="/images/line-breaks-flip.png" /></p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>OIdata<span class="p">)</span>
data<span class="p">(</span>birds<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>

<span class="kp">levels</span><span class="p">(</span>birds<span class="o">$</span>effect<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="kp">levels</span><span class="p">(</span>birds<span class="o">$</span>effect<span class="p">))</span>
ggplot<span class="p">(</span>birds<span class="p">,</span>
    aes<span class="p">(</span>x <span class="o">=</span> effect<span class="p">,</span>
        y <span class="o">=</span> speed<span class="p">))</span> <span class="o">+</span>
geom_boxplot<span class="p">()</span> <span class="o">+</span> 
coord_flip<span class="p">()</span>
</pre></div>


<p>Just a note: if you're not using <strong>ggplot</strong>, the multi-line axis labels might overflow into the graph.</p>
<p><a href="https://gist.github.com/mollietaylor/6930567#file-linebreaks-r">The code is available in a gist</a>.</p>
<h2>Citations and Further Reading</h2>
<ul>
<li><a href="http://regex.learncodethehardway.org/">http://regex.learncodethehardway.org/</a></li>
</ul>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/abline.html" rel="tag">abline</a>,  <a href="/tag/coord_flip.html" rel="tag">coord_flip</a>,  <a href="/tag/geom_boxplot.html" rel="tag">geom_boxplot</a>,  <a href="/tag/ggplot2.html" rel="tag">ggplot2</a>,  <a href="/tag/gsub.html" rel="tag">gsub</a>,  <a href="/tag/r.html" rel="tag">R</a>,  <a href="/tag/regular-expressions.html" rel="tag">regular expressions</a>,  <a href="/tag/visualization.html" rel="tag">visualization</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/2013/08/plot-weekly-or-monthly-totals-in-r.html">Thu 29 August 2013</a></div>
		<span class="byline">By <a href="/author/mollie-taylor.html">Mollie Taylor</a></span>
			<span class="cat-links"><a href="/category/r.html" title="View all posts in R" rel="category tag">R</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/2013/08/plot-weekly-or-monthly-totals-in-r.html" title="Permalink to Plot Weekly or Monthly Totals in R" rel="bookmark">Plot Weekly or Monthly Totals in R</a>
		</h2>
		<div class="entry-content">
			<p>When plotting time series data, you might want to bin the values so that each data point corresponds to the sum for a given month or week. This post will show an easy way to use <code>cut</code> and <strong>ggplot2</strong>'s <code>stat_summary</code> to plot month totals in R without needing to reorganize the data into a second data frame.</p>
<p>Let's start with a simple sample data set with a series of dates and quantities:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>scales<span class="p">)</span>

<span class="c1"># load data:</span>
log <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>Date <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;2013/05/25&quot;</span><span class="p">,</span><span class="s">&quot;2013/05/28&quot;</span><span class="p">,</span><span class="s">&quot;2013/05/31&quot;</span><span class="p">,</span><span class="s">&quot;2013/06/01&quot;</span><span class="p">,</span><span class="s">&quot;2013/06/02&quot;</span><span class="p">,</span><span class="s">&quot;2013/06/05&quot;</span><span class="p">,</span><span class="s">&quot;2013/06/07&quot;</span><span class="p">),</span> 
  Quantity <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">17</span><span class="p">,</span><span class="m">18</span><span class="p">))</span>
<span class="kp">log</span>
str<span class="p">(</span><span class="kp">log</span><span class="p">)</span>


<span class="o">:::</span>r
<span class="o">&gt;</span> <span class="kp">log</span>
        Date Quantity
<span class="m">1</span> <span class="m">2013</span><span class="o">/</span><span class="m">05</span><span class="o">/</span><span class="m">25</span>        <span class="m">9</span>
<span class="m">2</span> <span class="m">2013</span><span class="o">/</span><span class="m">05</span><span class="o">/</span><span class="m">28</span>        <span class="m">1</span>
<span class="m">3</span> <span class="m">2013</span><span class="o">/</span><span class="m">05</span><span class="o">/</span><span class="m">31</span>       <span class="m">15</span>
<span class="m">4</span> <span class="m">2013</span><span class="o">/</span><span class="m">06</span><span class="o">/</span><span class="m">01</span>        <span class="m">4</span>
<span class="m">5</span> <span class="m">2013</span><span class="o">/</span><span class="m">06</span><span class="o">/</span><span class="m">02</span>        <span class="m">5</span>
<span class="m">6</span> <span class="m">2013</span><span class="o">/</span><span class="m">06</span><span class="o">/</span><span class="m">05</span>       <span class="m">17</span>
<span class="m">7</span> <span class="m">2013</span><span class="o">/</span><span class="m">06</span><span class="o">/</span><span class="m">07</span>       <span class="m">18</span>

<span class="o">&gt;</span> str<span class="p">(</span><span class="kp">log</span><span class="p">)</span>
<span class="s">&#39;data.frame&#39;</span><span class="o">:</span> <span class="m">7</span> obs. of  <span class="m">2</span> variables<span class="o">:</span>
 <span class="o">$</span> Date    <span class="o">:</span> Factor w<span class="o">/</span> <span class="m">7</span> levels <span class="s">&quot;2013/05/25&quot;</span><span class="p">,</span><span class="s">&quot;2013/05/28&quot;</span><span class="p">,</span><span class="m">..</span><span class="o">:</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span>
 <span class="o">$</span> Quantity<span class="o">:</span> num  <span class="m">9</span> <span class="m">1</span> <span class="m">15</span> <span class="m">4</span> <span class="m">5</span> <span class="m">17</span> <span class="m">18</span>
</pre></div>


<p>Next, if the date data is not already in a date format, we'll need to <a href="/2013/08/date-formats-in-r.html">convert it to date format</a>:</p>
<div class="highlight"><pre><span class="c1"># convert date variable from factor to date format:</span>
<span class="kp">log</span><span class="o">$</span>Date <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span><span class="kp">log</span><span class="o">$</span>Date<span class="p">,</span>
    <span class="s">&quot;%Y/%m/%d&quot;</span><span class="p">)</span> <span class="c1"># tabulate all the options here</span>
str<span class="p">(</span><span class="kp">log</span><span class="p">)</span>


<span class="o">:::</span>r
<span class="o">&gt;</span> str<span class="p">(</span><span class="kp">log</span><span class="p">)</span>
<span class="s">&#39;data.frame&#39;</span><span class="o">:</span> <span class="m">7</span> obs. of  <span class="m">2</span> variables<span class="o">:</span>
 <span class="o">$</span> Date    <span class="o">:</span> Date<span class="p">,</span> <span class="kp">format</span><span class="o">:</span> <span class="s">&quot;2013-05-25&quot;</span> <span class="s">&quot;2013-05-28&quot;</span> <span class="kc">...</span>
 <span class="o">$</span> Quantity<span class="o">:</span> num  <span class="m">9</span> <span class="m">1</span> <span class="m">15</span> <span class="m">4</span> <span class="m">5</span> <span class="m">17</span> <span class="m">18</span>
</pre></div>


<p>Next we need to create variables stating the week and month of each observation. For week, <code>cut</code> has an option that allows you to break weeks as you'd like, beginning weeks on either Sunday or Monday.</p>
<div class="highlight"><pre><span class="c1"># create variables of the week and month of each observation:</span>
<span class="kp">log</span><span class="o">$</span>Month <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span><span class="kp">cut</span><span class="p">(</span><span class="kp">log</span><span class="o">$</span>Date<span class="p">,</span>
  breaks <span class="o">=</span> <span class="s">&quot;month&quot;</span><span class="p">))</span>
<span class="kp">log</span><span class="o">$</span>Week <span class="o">&lt;-</span> <span class="kp">as.Date</span><span class="p">(</span><span class="kp">cut</span><span class="p">(</span><span class="kp">log</span><span class="o">$</span>Date<span class="p">,</span>
  breaks <span class="o">=</span> <span class="s">&quot;week&quot;</span><span class="p">,</span>
  start.on.monday <span class="o">=</span> <span class="kc">FALSE</span><span class="p">))</span> <span class="c1"># changes weekly break point to Sunday</span>
<span class="kp">log</span>

<span class="o">&gt;</span> <span class="kp">log</span>
        Date Quantity      Month       Week
<span class="m">1</span> <span class="m">2013-05-25</span>        <span class="m">9</span> <span class="m">2013-05-01</span> <span class="m">2013-05-19</span>
<span class="m">2</span> <span class="m">2013-05-28</span>        <span class="m">1</span> <span class="m">2013-05-01</span> <span class="m">2013-05-26</span>
<span class="m">3</span> <span class="m">2013-05-31</span>       <span class="m">15</span> <span class="m">2013-05-01</span> <span class="m">2013-05-26</span>
<span class="m">4</span> <span class="m">2013-06-01</span>        <span class="m">4</span> <span class="m">2013-06-01</span> <span class="m">2013-05-26</span>
<span class="m">5</span> <span class="m">2013-06-02</span>        <span class="m">5</span> <span class="m">2013-06-01</span> <span class="m">2013-06-02</span>
<span class="m">6</span> <span class="m">2013-06-05</span>       <span class="m">17</span> <span class="m">2013-06-01</span> <span class="m">2013-06-02</span>
<span class="m">7</span> <span class="m">2013-06-07</span>       <span class="m">18</span> <span class="m">2013-06-01</span> <span class="m">2013-06-02</span>
</pre></div>


<p>Finally, we can create either a line or bar plot of the data by month and by week, using <code>stat_summary</code> to sum up the values associated with each week or month:</p>
<div class="highlight"><pre><span class="c1"># graph by month:</span>
ggplot<span class="p">(</span>data <span class="o">=</span> <span class="kp">log</span><span class="p">,</span>
    aes<span class="p">(</span>Month<span class="p">,</span> Quantity<span class="p">))</span> <span class="o">+</span>
    stat_summary<span class="p">(</span>fun.y <span class="o">=</span> <span class="kp">sum</span><span class="p">,</span> <span class="c1"># adds up all observations for the month</span>
        geom <span class="o">=</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="c1"># or &quot;line&quot;</span>
    scale_x_date<span class="p">(</span>
        labels <span class="o">=</span> date_format<span class="p">(</span><span class="s">&quot;%Y-%m&quot;</span><span class="p">),</span>
        breaks <span class="o">=</span> <span class="s">&quot;1 month&quot;</span><span class="p">)</span> <span class="c1"># custom x-axis labels</span>
</pre></div>


<p><img alt="Time series plot, binned by month" src="/images/plot-monthly-total.png" /></p>
<div class="highlight"><pre><span class="c1"># graph by week:</span>
ggplot<span class="p">(</span>data <span class="o">=</span> <span class="kp">log</span><span class="p">,</span>
    aes<span class="p">(</span>Week<span class="p">,</span> Quantity<span class="p">))</span> <span class="o">+</span>
    stat_summary<span class="p">(</span>fun.y <span class="o">=</span> <span class="kp">sum</span><span class="p">,</span> <span class="c1"># adds up all observations for the week</span>
        geom <span class="o">=</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="c1"># or &quot;line&quot;</span>
    scale_x_date<span class="p">(</span>
        labels <span class="o">=</span> date_format<span class="p">(</span><span class="s">&quot;%Y-%m-%d&quot;</span><span class="p">),</span>
        breaks <span class="o">=</span> <span class="s">&quot;1 week&quot;</span><span class="p">)</span> <span class="c1"># custom x-axis labels</span>
</pre></div>


<p><img alt="Time series plot, totaled by week" src="/images/plot-weekly-total.png" /></p>
<p>The full code is available in a <a href="https://gist.github.com/mollietaylor/5846843">gist</a>. </p>
<h2>References</h2>
<ul>
<li><a href="http://stackoverflow.com/questions/3496536/barplot-totals-by-month-with-ggplot">http://stackoverflow.com/questions/3496536/barplot-totals-by-month-with-ggplot</a></li>
</ul>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/asdate.html" rel="tag">as.Date</a>,  <a href="/tag/cut.html" rel="tag">cut</a>,  <a href="/tag/ggplot2.html" rel="tag">ggplot2</a>,  <a href="/tag/r.html" rel="tag">R</a>,  <a href="/tag/scale_x_date.html" rel="tag">scale_x_date</a>,  <a href="/tag/scales.html" rel="tag">scales</a>,  <a href="/tag/stat_summary.html" rel="tag">stat_summary</a>,  <a href="/tag/visualization.html" rel="tag">visualization</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/2013/03/geompoint-legend-with-custom-colors-in.html">Thu 07 March 2013</a></div>
		<span class="byline">By <a href="/author/mollie-taylor.html">Mollie Taylor</a></span>
			<span class="cat-links"><a href="/category/r.html" title="View all posts in R" rel="category tag">R</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/2013/03/geompoint-legend-with-custom-colors-in.html" title="Permalink to geom_point Legend with Custom Colors in ggplot" rel="bookmark">geom_point Legend with Custom Colors in ggplot</a>
		</h2>
		<div class="entry-content">
			<p>Formerly, I showed <a href="/2013/01/using-line-segments-to-compare-values.html">how to make line segments using ggplot</a>.</p>
<p>Working from that previous example, there are only a few things we need to change to add custom colors to our plot and legend in <strong>ggplot</strong>.</p>
<p>First, we'll add the colors of our choice. I'll do this using RColorBrewer, but you can choose <a href="/2012/10/palettes-in-r.html">whatever method you'd like</a>.</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>RColorBrewer<span class="p">)</span>
colors <span class="o">=</span> brewer.pal<span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="s">&quot;Dark2&quot;</span><span class="p">)</span>
</pre></div>


<p>The next section will be exactly the same as the previous example, except for removing the <code>scale_color_discrete</code> line to make way for the <code>scale_color_manual</code> we'll be adding later.</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>

data <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span>USPersonalExpenditure<span class="p">)</span> <span class="c1"># data from package datasets</span>
data<span class="o">$</span>Category <span class="o">&lt;-</span> <span class="kp">as.character</span><span class="p">(</span><span class="kp">rownames</span><span class="p">(</span>USPersonalExpenditure<span class="p">))</span> <span class="c1"># this makes things simpler later</span>

ggplot<span class="p">(</span>data<span class="p">,</span>
    aes<span class="p">(</span>x <span class="o">=</span> Expenditure<span class="p">,</span>
        y <span class="o">=</span> Category<span class="p">))</span> <span class="o">+</span>
labs<span class="p">(</span>x <span class="o">=</span> <span class="s">&quot;Expenditure&quot;</span><span class="p">,</span>
    y <span class="o">=</span> <span class="s">&quot;Category&quot;</span><span class="p">)</span> <span class="o">+</span>
geom_segment<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1940&quot;</span><span class="p">,</span>
        y <span class="o">=</span> Category<span class="p">,</span>
        xend <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1960&quot;</span><span class="p">,</span>
        yend <span class="o">=</span> Category<span class="p">),</span>
    size <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
geom_point<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1940&quot;</span><span class="p">,</span>
        color <span class="o">=</span> <span class="s">&quot;1940&quot;</span><span class="p">),</span> <span class="c1"># these can be any string, they just need to be unique identifiers</span>
    size <span class="o">=</span> <span class="m">4</span><span class="p">,</span>
    shape <span class="o">=</span> <span class="m">15</span><span class="p">)</span> <span class="o">+</span>
geom_point<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1960&quot;</span><span class="p">,</span>
        color <span class="o">=</span> <span class="s">&quot;1960&quot;</span><span class="p">),</span>
    size <span class="o">=</span> <span class="m">4</span><span class="p">,</span>
    shape <span class="o">=</span> <span class="m">15</span><span class="p">)</span> <span class="o">+</span>
theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;bottom&quot;</span><span class="p">)</span> <span class="o">+</span>
</pre></div>


<p>And finally, we'll add a <code>scale_color_manual</code> line to our plot. We need to define the name, labels, and colors of the plot.</p>
<div class="highlight"><pre>scale_color_manual(name = &quot;Year&quot;, # or name = element_blank()
    labels = c(1940, 1960),
    values = colors)
</pre></div>


<p>And here's our final plot, complete with whatever custom colors we've chosen in both the plot and legend:</p>
<p><img alt="geom_point in ggplot with custom colors in the graph and legend" src="/images/ggplot-custom-legend.png" /></p>
<p>I've updated the <a href="https://gist.github.com/mollietaylor/4543148#file-customlegend-r">gist</a> from the previous post to also include a file that has custom colors.</p>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/geom_point.html" rel="tag">geom_point</a>,  <a href="/tag/geom_segment.html" rel="tag">geom_segment</a>,  <a href="/tag/ggplot2.html" rel="tag">ggplot2</a>,  <a href="/tag/r.html" rel="tag">R</a>,  <a href="/tag/rcolorbrewer.html" rel="tag">RColorBrewer</a>,  <a href="/tag/scale_color_manual.html" rel="tag">scale_color_manual</a>,  <a href="/tag/visualization.html" rel="tag">visualization</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/2013/02/elevation-profiles-in-r.html">Thu 21 February 2013</a></div>
		<span class="byline">By <a href="/author/mollie-taylor.html">Mollie Taylor</a></span>
			<span class="cat-links"><a href="/category/r.html" title="View all posts in R" rel="category tag">R</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/2013/02/elevation-profiles-in-r.html" title="Permalink to Elevation Profiles in R" rel="bookmark">Elevation Profiles in R</a>
		</h2>
		<div class="entry-content">
			<p>First, let's load up our data. <a href="https://gist.github.com/mollietaylor/4969793">The data are available in a gist</a>. You can convert your own GPS data to .csv by following the instructions <a href="http://www.mollietaylor.com/2012/12/mapping-gps-tracks-in-r.html">here, using gpsbabel</a>.</p>
<div class="highlight"><pre>gps <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;callan.csv&quot;</span><span class="p">,</span>
    header <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>


<p>Next, we can use the function <code>SMA</code> from the package <strong>TTR</strong> to calculate a <a href="http://en.wikipedia.org/wiki/Moving_average">moving average</a> of the altitude or elevation data, if we want to smooth out the curve. We can define a constant for the number of data points we want to average to create each moving average value.</p>
<p>If you don't want to convert meters to feet, a metric version of the code is available in the gist (<a href="https://gist.github.com/mollietaylor/4969793">callanMetric.R</a>).</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>TTR<span class="p">)</span>
movingN <span class="o">&lt;-</span> <span class="m">5</span> <span class="c1"># define the n for the moving average calculations</span>
gps<span class="o">$</span>Altitude <span class="o">&lt;-</span> gps<span class="o">$</span>Altitude <span class="o">*</span> <span class="m">3.281</span> <span class="c1"># convert m to ft</span>
gps<span class="o">$</span>SMA <span class="o">&lt;-</span> SMA<span class="p">(</span>gps<span class="o">$</span>Altitude<span class="p">,</span>
    n <span class="o">=</span> movingN<span class="p">)</span>
gps <span class="o">&lt;-</span> gps<span class="p">[</span>movingN<span class="o">:</span><span class="kp">length</span><span class="p">(</span>gps<span class="o">$</span>SMA<span class="p">),</span> <span class="p">]</span> <span class="c1"># remove first n-1 points</span>
</pre></div>


<p>Next, we want to calculate the distance of each point. You can skip this step if your dataset already includes distances.</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>sp<span class="p">)</span>
Dist <span class="o">&lt;-</span> <span class="m">0</span>
<span class="kr">for</span><span class="p">(</span>i <span class="kr">in</span> <span class="m">2</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>gps<span class="o">$</span>Longitude<span class="p">))</span> <span class="p">{</span>
    Dist<span class="p">[</span>i<span class="p">]</span> <span class="o">=</span> spDistsN1<span class="p">(</span><span class="kp">as.matrix</span><span class="p">(</span>gps<span class="p">[</span>i<span class="p">,</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;Longitude&quot;</span><span class="p">,</span> <span class="s">&quot;Latitude&quot;</span><span class="p">)]),</span>
    <span class="kt">c</span><span class="p">(</span>gps<span class="o">$</span>Longitude<span class="p">[</span>i<span class="m">-1</span><span class="p">],</span> gps<span class="o">$</span>Latitude<span class="p">[</span>i<span class="m">-1</span><span class="p">]),</span>
    longlat <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">/</span> <span class="m">1.609</span> <span class="c1"># longlat so distances will be in km, then divide to convert to miles</span>
<span class="p">}</span>
gps<span class="o">$</span>Dist <span class="o">&lt;-</span> Dist

DistTotal <span class="o">&lt;-</span> <span class="m">0</span>
<span class="kr">for</span><span class="p">(</span>i <span class="kr">in</span> <span class="m">2</span><span class="o">:</span><span class="kp">length</span><span class="p">(</span>gps<span class="o">$</span>Longitude<span class="p">))</span> <span class="p">{</span>
    DistTotal<span class="p">[</span>i<span class="p">]</span> <span class="o">=</span> Dist<span class="p">[</span>i<span class="p">]</span> <span class="o">+</span> DistTotal<span class="p">[</span>i<span class="m">-1</span><span class="p">]</span>
<span class="p">}</span>
gps<span class="o">$</span>DistTotal <span class="o">&lt;-</span> DistTotal
</pre></div>


<p>And finally, we can plot our elevation data using geom_ribbons and ggplot:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
ggplot<span class="p">(</span>gps<span class="p">,</span> aes<span class="p">(</span>x <span class="o">=</span> DistTotal<span class="p">))</span> <span class="o">+</span>
geom_ribbon<span class="p">(</span>aes<span class="p">(</span>ymin <span class="o">=</span> <span class="m">600</span><span class="p">,</span> <span class="c1"># change this to match your min below</span>
        ymax <span class="o">=</span> SMA<span class="p">),</span>
    fill <span class="o">=</span> <span class="s">&quot;#1B9E77&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="c1"># put your altitude variable here if not using moving averages</span>
labs<span class="p">(</span>x <span class="o">=</span> <span class="s">&quot;Miles&quot;</span><span class="p">,</span>
    y <span class="o">=</span> <span class="s">&quot;Elevation&quot;</span><span class="p">)</span> <span class="o">+</span>
scale_y_continuous<span class="p">(</span>limits <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">600</span><span class="p">,</span><span class="m">1200</span><span class="p">))</span> <span class="c1"># change this to limits appropriate for your region</span>
</pre></div>


<p><img alt="Elevation profile in ggplot2" class="size-auto" src="/images/r-elevation.png" /></p>
<p><a href="https://gist.github.com/mollietaylor/4969793">Code and data available in a gist</a>.</p>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/geom_ribbon.html" rel="tag">geom_ribbon</a>,  <a href="/tag/ggplot2.html" rel="tag">ggplot2</a>,  <a href="/tag/gps.html" rel="tag">gps</a>,  <a href="/tag/r.html" rel="tag">R</a>,  <a href="/tag/sma.html" rel="tag">SMA</a>,  <a href="/tag/sp.html" rel="tag">sp</a>,  <a href="/tag/spdistsn1.html" rel="tag">spDistsN1</a>,  <a href="/tag/ttr.html" rel="tag">TTR</a>,  <a href="/tag/visualization.html" rel="tag">visualization</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/2013/01/using-line-segments-to-compare-values.html">Thu 31 January 2013</a></div>
		<span class="byline">By <a href="/author/mollie-taylor.html">Mollie Taylor</a></span>
			<span class="cat-links"><a href="/category/r.html" title="View all posts in R" rel="category tag">R</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/2013/01/using-line-segments-to-compare-values.html" title="Permalink to Using Line Segments to Compare Values in R" rel="bookmark">Using Line Segments to Compare Values in R</a>
		</h2>
		<div class="entry-content">
			<p>Sometimes you want to create a graph that will allow the viewer to see in one glance:</p>
<ul>
<li>The original value of a variable</li>
<li>The new value of the variable</li>
<li>The change between old and new</li>
</ul>
<p>One method I like to use to do this is using <code>geom_segment</code> and <code>geom_point</code> in the <strong>ggplot2</strong> package.</p>
<p>First, let's load <strong>ggplot2</strong> and our data:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>

data <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span>USPersonalExpenditure<span class="p">)</span> <span class="c1"># data from package datasets</span>
data<span class="o">$</span>Category <span class="o">&lt;-</span> <span class="kp">as.character</span><span class="p">(</span><span class="kp">rownames</span><span class="p">(</span>USPersonalExpenditure<span class="p">))</span> <span class="c1"># this makes things simpler later</span>
</pre></div>


<p>Next, we'll set up our plot and axes:</p>
<div class="highlight"><pre>ggplot<span class="p">(</span>data<span class="p">,</span>
    aes<span class="p">(</span>y <span class="o">=</span> Category<span class="p">))</span> <span class="o">+</span>
labs<span class="p">(</span>x <span class="o">=</span> <span class="s">&quot;Expenditure&quot;</span><span class="p">,</span>
    y <span class="o">=</span> <span class="s">&quot;Category&quot;</span><span class="p">)</span> <span class="o">+</span>
</pre></div>


<p>For <code>geom_segment</code>, we need to provide four variables. (Sometimes two of the four will be the same, like in this case.) <code>x</code> and <code>y</code> provide the start points, and <code>xend</code> and <code>yend</code> provide the endpoints.</p>
<p>In this case, we want to show the change between 1940 and 1960 for each category. Therefore our variables are the following:</p>
<ul>
<li>x: "1940"</li>
<li>y: Category</li>
<li>xend: "1960"</li>
<li>yend: Category</li>
</ul>
<!--end the list-->

<div class="highlight"><pre>geom_segment<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1940&quot;</span><span class="p">,</span>
  y <span class="o">=</span> Category<span class="p">,</span>
  xend <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1960&quot;</span><span class="p">,</span>
  yend <span class="o">=</span> Category<span class="p">),</span>
 size <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
</pre></div>


<p>Next, we want to plot points for the 1940 and 1960 values. We could do the same for the 1945, 1950, and 1955 values, if we wanted to.</p>
<div class="highlight"><pre>geom_point<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1940&quot;</span><span class="p">,</span>
    color <span class="o">=</span> <span class="s">&quot;1940&quot;</span><span class="p">),</span>
    size <span class="o">=</span> <span class="m">4</span><span class="p">,</span> shape <span class="o">=</span> <span class="m">15</span><span class="p">)</span> <span class="o">+</span>
geom_point<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1960&quot;</span><span class="p">,</span>
    color <span class="o">=</span> <span class="s">&quot;1960&quot;</span><span class="p">),</span>
    size <span class="o">=</span> <span class="m">4</span><span class="p">,</span> shape <span class="o">=</span> <span class="m">15</span><span class="p">)</span> <span class="o">+</span>
</pre></div>


<p>Finally, we'll finish up by touching up the legend for the plot:</p>
<div class="highlight"><pre>scale_color_discrete<span class="p">(</span>name <span class="o">=</span> <span class="s">&quot;Year&quot;</span><span class="p">)</span> <span class="o">+</span>
theme<span class="p">(</span>legend.position <span class="o">=</span> <span class="s">&quot;bottom&quot;</span><span class="p">)</span>
</pre></div>


<p><img alt="geom_segment, then geom_point" src="/images/r-line-segments.png" /></p>
<p>The order of <code>geom_segment</code> and the <code>geom_points</code> matters. The first <code>geom</code> line in the code will get plotted first. Therefore, if you want the points displayed over the segments, put the segments first in the code. Likewise, if you want the segments displayed over the points, put the points first in the code.</p>
<p>For example, we could change the middle section of the code to:</p>
<div class="highlight"><pre>geom_point<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1940&quot;</span><span class="p">,</span>
  color <span class="o">=</span> <span class="s">&quot;1940&quot;</span><span class="p">),</span>
  size <span class="o">=</span> <span class="m">4</span><span class="p">,</span> shape <span class="o">=</span> <span class="m">15</span><span class="p">)</span> <span class="o">+</span>
geom_point<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1960&quot;</span><span class="p">,</span>
  color <span class="o">=</span> <span class="s">&quot;1960&quot;</span><span class="p">),</span>
  size <span class="o">=</span> <span class="m">4</span><span class="p">,</span> shape <span class="o">=</span> <span class="m">15</span><span class="p">)</span> <span class="o">+</span>

geom_segment<span class="p">(</span>aes<span class="p">(</span>x <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1940&quot;</span><span class="p">,</span>
    y <span class="o">=</span> Category<span class="p">,</span>
    xend <span class="o">=</span> data<span class="o">$</span><span class="s">&quot;1960&quot;</span><span class="p">,</span>
    yend <span class="o">=</span> Category<span class="p">),</span>
  size <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
</pre></div>


<p>And the output would look like:</p>
<p><img alt="geom_point, then geom_segment" src="/images/r-line-segments.png" /></p>
<p>Similarly, if you have points that will be overlapping, make sure you think about which of the point lines you want R to plot first.</p>
<p>The code is available in a <a href="https://gist.github.com/4543148">gist</a>.</p>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/datasets.html" rel="tag">datasets</a>,  <a href="/tag/geom_point.html" rel="tag">geom_point</a>,  <a href="/tag/geom_segment.html" rel="tag">geom_segment</a>,  <a href="/tag/ggplot2.html" rel="tag">ggplot2</a>,  <a href="/tag/legend.html" rel="tag">legend</a>,  <a href="/tag/r.html" rel="tag">R</a>,  <a href="/tag/visualization.html" rel="tag">visualization</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="post type-post status-publish format-standard hentry category-general" id="post">
	<div class="entry-meta">
		<div class="date"><a href="/2013/01/calculating-gini-coefficients-for.html">Thu 17 January 2013</a></div>
		<span class="byline">By <a href="/author/mollie-taylor.html">Mollie Taylor</a></span>
			<span class="cat-links"><a href="/category/r.html" title="View all posts in R" rel="category tag">R</a></span>
	</div> <!-- /#entry-meta -->
	<div class="main">
		<h2 class="entry-title">
			<a href="/2013/01/calculating-gini-coefficients-for.html" title="Permalink to Calculating Gini Coefficients for a Number of Locales at Once in R" rel="bookmark">Calculating Gini Coefficients for a Number of Locales at Once in R</a>
		</h2>
		<div class="entry-content">
			<p>The <a href="http://en.wikipedia.org/wiki/Gini_coefficient">Gini coefficient</a> is a measure of the inequality of a distribution, most commonly used to compare inequality in income or wealth among countries.</p>
<p>Let's first generate some random data to analyze. You can <a href="https://gist.github.com/4432069">download my random data</a> or use the code below to generate your own. Of course, if you generate your own, your graphs and results will be different from those shown below.</p>
<div class="highlight"><pre>city <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="s">&quot;C&quot;</span><span class="p">,</span> <span class="s">&quot;D&quot;</span><span class="p">,</span> <span class="s">&quot;E&quot;</span><span class="p">,</span> <span class="s">&quot;F&quot;</span><span class="p">,</span> <span class="s">&quot;G&quot;</span><span class="p">,</span> <span class="s">&quot;H&quot;</span><span class="p">,</span> <span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="s">&quot;J&quot;</span><span class="p">)</span>
income <span class="o">&lt;-</span> <span class="kp">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100000</span><span class="p">,</span>
    <span class="m">100</span><span class="p">,</span>
    replace <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
cities <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>city<span class="p">,</span> income<span class="p">)</span>
</pre></div>


<p>Next, let's graph our data:</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
ggplot<span class="p">(</span>cities<span class="p">,</span>
    aes<span class="p">(</span>income<span class="p">))</span> <span class="o">+</span>
    stat_density<span class="p">(</span>geom <span class="o">=</span> <span class="s">&quot;path&quot;</span><span class="p">,</span>
        position <span class="o">=</span> <span class="s">&quot;identity&quot;</span><span class="p">)</span> <span class="o">+</span>
    facet_wrap<span class="p">(</span><span class="o">~</span> city<span class="p">,</span> ncol <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
</pre></div>


<p><img alt="Histogram of each city's incomes // Your results will differ if using random data" src="/images/r-gini-hist.png" /></p>
<p>The Gini coefficient is easy enough to calculate in R for a single locale using the <code>gini</code> function from the <strong>reldist</strong> package.</p>
<div class="highlight"><pre><span class="kn">library</span><span class="p">(</span>reldist<span class="p">)</span>
gini<span class="p">(</span>cities<span class="p">[</span><span class="kp">which</span><span class="p">(</span>cities<span class="o">$</span>city <span class="o">==</span> <span class="s">&quot;A&quot;</span><span class="p">),</span> <span class="p">]</span><span class="o">$</span>income<span class="p">)</span>
</pre></div>


<p>But we don't want to replicate this code over and over to calculate the Gini coefficient for a large number of locales. We also want the coefficients to be in a data frame for easy use in R or for export for use in another program.</p>
<p>There are <a href="http://www.slideshare.net/jeffreybreen/grouping-summarizing-data-in-r">many ways to automate a function</a> to run over many subsets of a data frame. The most straightforward in our particular case is <code>aggregate</code>:</p>
<div class="highlight"><pre>ginicities <span class="o">&lt;-</span> aggregate<span class="p">(</span>income <span class="o">~</span> city<span class="p">,</span>
    data <span class="o">=</span> cities<span class="p">,</span>
    FUN <span class="o">=</span> <span class="s">&quot;gini&quot;</span><span class="p">)</span>
<span class="kp">names</span><span class="p">(</span>ginisec<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">,</span> <span class="s">&quot;gini&quot;</span><span class="p">)</span>

<span class="o">&gt;</span> ginisec
   city      gini
<span class="m">1</span>     A <span class="m">0.2856827</span>
<span class="m">2</span>     B <span class="m">0.3639070</span>
<span class="m">3</span>     C <span class="m">0.3288934</span>
<span class="m">4</span>     D <span class="m">0.1863783</span>
<span class="m">5</span>     E <span class="m">0.3565739</span>
<span class="m">6</span>     <span class="bp">F</span> <span class="m">0.2587475</span>
<span class="m">7</span>     G <span class="m">0.3022642</span>
<span class="m">8</span>     H <span class="m">0.3795288</span>
<span class="m">9</span>     I <span class="m">0.3311034</span>
<span class="m">10</span>    J <span class="m">0.2496933</span>
</pre></div>


<p>And finally, let's go ahead and export our data using <code>write.csv</code>:</p>
<div class="highlight"><pre>write.csv<span class="p">(</span>ginicities<span class="p">,</span> <span class="s">&quot;gini.csv&quot;</span><span class="p">,</span>
    row.names <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</pre></div>


<p>While you're at it, you might want to try using other functions on your dataset, such as <code>mean</code>, <code>median</code>, and <code>length</code>.</p>
<p>The full code is available in a <a href="https://gist.github.com/4432069">gist</a>.</p>
<h2>Citations and Further Reading</h2>
<ul>
<li><a href="http://rss.acs.unt.edu/Rdoc/library/reldist/html/gini.html">http://rss.acs.unt.edu/Rdoc/library/reldist/html/gini.html</a></li>
<li><a href="http://www.slideshare.net/jeffreybreen/grouping-summarizing-data-in-r">http://www.slideshare.net/jeffreybreen/grouping-summarizing-data-in-r</a></li>
</ul>
		</div> <!--/#entry-content-->
    		<span class="tag-links"><strong>Tagged</strong>
 <a href="/tag/aggregate.html" rel="tag">aggregate</a>,  <a href="/tag/analysis.html" rel="tag">analysis</a>,  <a href="/tag/ggplot2.html" rel="tag">ggplot2</a>,  <a href="/tag/gini.html" rel="tag">gini</a>,  <a href="/tag/r.html" rel="tag">R</a>,  <a href="/tag/reldist.html" rel="tag">reldist</a>,  <a href="/tag/sample.html" rel="tag">sample</a>,  <a href="/tag/stat_density.html" rel="tag">stat_density</a>,  <a href="/tag/writecsv.html" rel="tag">write.csv</a>    		</span>
	</div> <!--/#main-->
</div>  <!--/#post--><div class="navigation">
</div>
		</div>
		
		<div id="footer">
			<p>Powered by <a href="http://getpelican.com">Pelican</a>, theme by <a href="http://bunnyman.info">tBunnyMan</a>.</p>
		</div><!-- /#footer -->
	</div><!-- /#container -->
	<div style="display:none"></div>
</body>
</html>